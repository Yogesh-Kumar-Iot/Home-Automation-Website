<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
  font-family: Arial;
  color: rgb(10, 10, 10);
}

h1 {
    text-align: center;
    font-family:  serif;
   
}
h2 {
  text-align: center;
  font-family:  serif;
 
}

.split {
  height: 100%;
  width: 50%;
  position: fixed;
  z-index: 1;
  top: 0;
  overflow-x: hidden;
  padding-top: 20px;
}

.left {
  left: 0;
  background-color: rgb(218, 194, 194);
}

.right {
  right: 0;
  background-color: rgb(159, 119, 119);
}

.centered {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

.centered img {
  width: 150px;
  border-radius: 50%;
}





  .container1 {
    position: relative;
    width: 100%;
    max-width: 400px;
  }
  
  
  
  .container1 .btn {
    position: absolute;
    top: 200%;
    left: 100%;
    transform: translate(-50%, -50%);
    -ms-transform: translate(-50%, -50%);
    background-color: #53aeab;
    color: black;
    font-size: 16px;
    padding: 16px 30px;
    border: none;
    cursor: pointer;
    border-radius: 5px;
    text-align: center;
  }
  
  .container1 .btn:hover {
    background-color: rgb(228, 147, 147);
    color: white;
  }


  .container1 {
    position: relative;
    width: 100%;
    max-width: 400px;
  }
  
  
  
  .container1 .btn1 {
    position: absolute;
    top: 200%;
    left: 120%;
    transform: translate(-50%, -50%);
    -ms-transform: translate(-50%, -50%);
    background-color: #53aeab;
    color: black;
    font-size: 16px;
    padding: 16px 30px;
    border: none;
    cursor: pointer;
    border-radius: 5px;
    text-align: center;
  }
  
  .container1 .btn1:hover {
    background-color: rgb(228, 147, 147);
    color: white;
  }

  .container1 {
    position: relative;
    width: 100%;
    max-width: 400px;
  }
  
  
  
  .container1 .btn0 {
    position: absolute;
    top: 200%;
    left: 80%;
    transform: translate(-50%, -50%);
    -ms-transform: translate(-50%, -50%);
    background-color: #53aeab;
    color: black;
    font-size: 16px;
    padding: 16px 30px;
    border: none;
    cursor: pointer;
    border-radius: 5px;
    text-align: center;
  }
  
  .container1 .btn0:hover {
    background-color: rgb(228, 147, 147);
    color: white;
  }


  body {font-family: Arial, Helvetica, sans-serif;}
form {border: 3px solid #f1f1f1;}

input[type=text], input[type=password] {
  width: 100%;
  padding: 12px 20px;
  margin: 8px 0;
  display: inline-block;
  border: 1px solid #ccc;
  box-sizing: border-box;
}

button9 {
  background-color: #04AA6D;
  color: white;
  padding: 14px 20px;
  margin: 8px 0;
  border: none;
  cursor: pointer;
  width: 100%;
}

button9:hover {
  opacity: 0.8;
}

.cancelbtn {
  width: auto;
  padding: 10px 18px;
  background-color: #f44336;
}

.imgcontainer {
  text-align: center;
  margin: 24px 0 12px 0;
}

img.avatar {
  width: 40%;
  border-radius: 50%;
}

.container {
  padding: 10px;
  width: 300px;
}

span.psw {
  float: right;
  padding-top: 16px;
}

@media screen and (max-width: 300px) {
  span.psw {
     display: block;
     float: none;
  }
 
}
.container1 .btn7 {
    position: absolute;
    top: 400%;
    left: 100%;
    transform: translate(-50%, -50%);
    -ms-transform: translate(-50%, -50%);
    background-color: #53aeab;
    color: black;
    font-size: 16px;
    padding: 16px 30px;
    border: none;
    cursor: pointer;
    border-radius: 5px;
    text-align: center;
  }
  .buttona {
    background-color: #53aeab;
    color: white;
    padding: 14px 20px;
    margin: 8px 0;
    border: none;
    cursor: pointer;
    width: 100%;
    align-items: center;
    top: 400%;
    left: 50%;
  }
  
  .buttona:hover43 {
    opacity: 0.8;
    color: #f1f1f1;
  }
  
#M_S
{
  width: 350px;
  height: 250px;
  padding-left: 200px;
}

</style>





</head>
<body>
  
<div class="split left">
  <h1> One Time Motor On </h1>
  <h2> Current Motor Status</h2>
  
  
  <br>
  <br>
  <div class="container1">
    <img src="images/loading..gif" id="M_S" alt="Motor_s">
  </div>
  
   
<br>
<br>
  <h1>Update Status</h1>
  <br>
  <br>
 <br>
  <div class="container1">
    <button class="btn0" id="On_status">ON</button>
  </div> 
  
  <div class="container1">
    <button class="btn1" id="Off_status">OFF</button>
  </div>

 


  </div>
</div>

<div class="split right">
  <h1> Set Daily Motor On Time </h1>
  
 <!--<form action="/action_page.php" method="post">-->
  

    <div class="container">
      <div style="padding-left:300px ;">
        <div>
        <b>Runtime</b>
      <p id="runtime">Loding...</p>
    
      <b>Duration</b>
      <p id="Duration">Loding...</p>

      <label for="psw"><b>Motor Status</b></label>
      <p id="Motorstatus">Loding...</p>
    </div>
    </div>   
    </div>

  </form>

  <h1> Update Status</h1>

    <div class="container" style="padding-left: 300px;">
      <label for="uname"><b>Runtime Time</b></label>
      <input type="text"  name="psw" id="uruntime">
      <label for="psw"><b>Duration</b></label>
      <input type="text"  name="psw"id="uduration" required>

      <button type="submit" class="buttona" id="update_status">Update</button>
<br>
<br>
<br>

  <br>   
    </div>







  </div>
  
</div>
<script type="module" type="text/javascript">
	// <![CDATA[  <-- For SVG support
  
	if ('WebSocket' in window) {
		(function () {
			function refreshCSS() {
				var sheets = [].slice.call(document.getElementsByTagName("link"));
				var head = document.getElementsByTagName("head")[0];
				for (var i = 0; i < sheets.length; ++i) {
					var elem = sheets[i];
					var parent = elem.parentElement || head;
					parent.removeChild(elem);
					var rel = elem.rel;
					if (elem.href && typeof rel != "string" || rel.length == 0 || rel.toLowerCase() == "stylesheet") {
						var url = elem.href.replace(/(&|\?)_cacheOverride=\d+/, '');
						elem.href = url + (url.indexOf('?') >= 0 ? '&' : '?') + '_cacheOverride=' + (new Date().valueOf());
					}
					parent.appendChild(elem);
				}
			}
			var protocol = window.location.protocol === 'http:' ? 'ws://' : 'wss://';
			var address = protocol + window.location.host + window.location.pathname + '/ws';
			var socket = new WebSocket(address);
			socket.onmessage = function (msg) {
				if (msg.data == 'reload') window.location.reload();
				else if (msg.data == 'refreshcss') refreshCSS();
			};
			if (sessionStorage && !sessionStorage.getItem('IsThisFirstTime_Log_From_LiveServer')) {
				console.log('Live reload enabled.');
				sessionStorage.setItem('IsThisFirstTime_Log_From_LiveServer', true);
			}
		})();
	}
	else {
		console.error('Upgrade your browser. This Browser is NOT supported WebSocket for Live-Reloading.');
	}
	// ]]>

  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js";
  const firebaseConfig = {
    apiKey: "AIzaSyDJVQPBMvE8-g3veC-NahGEWDsQOAtd6Yc",
    authDomain: "dht11-training.firebaseapp.com",
    databaseURL: "https://dht11-training-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "dht11-training",
    storageBucket: "dht11-training.appspot.com",
    messagingSenderId: "325497977243",
    appId: "1:325497977243:web:0b46bf7207a7f5f855c93e"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  import {getDatabase,ref,child,get,set,update,remove} from "https://www.gstatic.com/firebasejs/10.10.0/firebase-database.js";
  const db=getDatabase();
  

  window.onload=function()
  {
   
  // MOtor Status
    get(ref(db, 'Gardening/Motor_status')).then((snapshot) => {
    const data = snapshot.val();
   if(data)
    {
     var img=document.getElementById('M_S');
     img.src="/images/motor_on.gif";
     document.getElementById('Motorstatus').textContent="On";
    }
   else{
    var img=document.getElementById('M_S');
     img.src="/images/motor_off.png";
     document.getElementById('Motorstatus').textContent="Off";
  }
  }).catch((error) => {
    // Handle potential errors during data fetching
    console.error("Error fetching data:", error);
  });
  get(ref(db, 'Gardening/Duration')).then((snapshot) => {
    const data = snapshot.val();
    document.getElementById('Duration').textContent =data+" minutes";
  });

  get(ref(db, 'Gardening/run_time')).then((snapshot) => {
    const data = snapshot.val();
    document.getElementById('runtime').textContent =data;
  });

  const refreshInterval = setInterval(() => {
    location.reload(); // Reload the entire page
  }, 100000); 
 
  }
  //Room Light on status update Function
  function Motor_status_on()
  {
    update(ref(db,'Gardening/'),{
    Motor_status:true}).then(()=>{
      //document.querySelector('#RB_S').textContent="on";
      var img=document.getElementById('M_S');
     img.src="/images/motor_on.gif";
     document.getElementById('Motorstatus').textContent="On";
      alert("Motor status updated succefully");
    })
    .catch((error)=>
    {
      alert("unsuccessfull");
      console.log(error);
    })
  }
  function Motor_status_off()
  {
    update(ref(db,'Gardening/'),{
    Motor_status:false}).then(()=>{
      //document.querySelector('#RB_S').textContent="on";
      var img=document.getElementById('M_S');
     img.src="/images/motor_off.png";
     document.getElementById('Motorstatus').textContent="Off";
      alert("Motor status updated succefully");
    })
    .catch((error)=>
    {
      alert("unsuccessfull");
      console.log(error);
    })
  }
  
  function Runtime_and_duration_update() {
  // Retrieve values
  var newt = document.getElementById('uruntime').value.trim();
  var nDuration;

  // Time format validation (using regular expression)
  const timeRegex = /^([0-1][0-9]|2[0-3]):([0-5][0-9])$/;
  if (!timeRegex.test(newt)) {
    alert("Error: Invalid runtime format. Please use HH:MM (24-hour format).");
    return; // Exit the function if format is invalid
  }

  try {
    nDuration = parseInt(document.getElementById('uduration').value.trim());
    if (isNaN(nDuration)) {
      throw new Error("Invalid duration value. Please enter a number.");
    }
  } catch (error) {
    alert("Error: " + error.message);
    console.error(error);
    return; // Exit the function if error occurs during conversion
  }

  // Update runtime and duration in Firestore with error handling
  update(ref(db, 'Gardening/'), {
    run_time: newt,
  })
  .then(() => {
    document.getElementById('runtime').textContent = newt;
    return update(ref(db, 'Gardening/'), {
      Duration: nDuration, // Field name might require adjustment based on your schema
    });
  })
  .then(() => {
    document.getElementById('Duration').textContent = nDuration+" minutes";
    alert("Runtime and Duration updated successfully!");
  })
  .catch((error) => {
    alert("Unsuccessful update: " + error.message);
    console.error(error);
  });
  document.getElementById('uruntime').value='';
  document.getElementById('uduration').value='';
  
}


  On_status.addEventListener("click",Motor_status_on);
  Off_status.addEventListener("click",Motor_status_off);
  update_status.addEventListener("click",Runtime_and_duration_update);
  </script>
</body>
</html> 
